// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  THERAPIST
  PATIENT
}

enum SenderType {
  USER
  AI
  SYSTEM
}

enum ConversationStatus {
  ACTIVE
  ARCHIVED
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String
  role          Role      @default(PATIENT)
  metadata      Json?
  therapistId   String?
  therapist     User?     @relation("TherapistPatients", fields: [therapistId], references: [id])
  patients      User[]    @relation("TherapistPatients")
  conversations Conversation[]
  tokenLogs     TokenLog[]
  moodLogs      MoodLog[]
  journalEntries JournalEntry[]
}

model Conversation {
  id        String             @id @default(cuid())
  userId    String
  user      User               @relation(fields: [userId], references: [id])
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  summary   String?            @db.Text
  status    ConversationStatus @default(ACTIVE)
  messages  ChatMessage[]
  tokenLogs TokenLog[]
}

model ChatMessage {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  text           String       @db.Text
  sender         SenderType
  tokenUsage     Json?
  createdAt      DateTime     @default(now())
}

model TokenLog {
  id               String        @id @default(cuid())
  userId           String
  user             User          @relation(fields: [userId], references: [id])
  conversationId   String?
  conversation     Conversation? @relation(fields: [conversationId], references: [id])
  promptTokens     Int?
  completionTokens Int?
  modelName        String
  createdAt        DateTime      @default(now())
}

model MoodLog {
  id        String   @id @default(cuid())
  mood      String
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

model JournalEntry {
  id        String   @id @default(cuid())
  title     String
  content   String
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}